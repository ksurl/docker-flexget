#!/bin/sh

rm -f /config/.config-lock 2> /dev/null 

if [ ! -f /config/config.yml ]; then
  echo "no config file found."
  exit
fi

cp "/usr/share/zoneinfo/${TZ:-America/Los_Angeles}" /etc/localtime && echo "${TZ:-America/Los_Angeles}" > /etc/timezone
LOGFILE="--logfile ${LOG_FILE:-/config/flexget.log}"
LOGLEVEL="--loglevel ${LOG_LEVEL:-info}"

su-exec ${PUID:-1000}:${PGID:-1000} /usr/local/bin/flexget $LOGFILE $LOGLEVEL daemon start --autoreload-config
